<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title></title>
		<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css">
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/jquery.mobile-1.3.2.min.js"></script>
		<script src="js/jquery.md5.js"></script>
		<style type="text/css">
			body {background-color: #88a6b1}
			.round {
				display: inline-block;
    			text-align: center;
			    box-shadow: inset 1px -6px 10px #fff;
			    width: .9rem;
			    height: .9rem;
			    border-radius: .9rem;
			    background: #d5d5d5;
			    color: #000!important;
			    margin-right: .1rem;
			    line-height: .9rem;
			    font-size: .6rem;
			}
			
			.textCenter {
				text-align: center;
			}
			
			.col {
			    padding: .4rem 0;
			    font-size: .92rem;
			}
			
			.bet {
				font-weight: bolder;
    			color: rgba(0, 0, 0, .8);
			}
			
			.bet-content {
			    display: inline-block;
			    line-height: 1.4rem;
			}
			
			.round-1 {
				line-height: 1.4rem;
				display: inline-block;
				text-align: center;
				box-shadow: inset 1px -6px 10px #fff;
				background: #d5d5d5;
				color: #000!important;
			    width: 1.4rem;
			    height: 1.4rem;
			    border-radius: 1.4rem;
			    font-size: .9rem;
			    font-weight: bolder;
			}
			
			#rightTwoDiv {
				overflow-y: scroll;
			}
			
			.box {
				border: 1px solid rgb(217, 232, 247);
			}
			
			table, table tr th, table tr td {
				border:1px solid #0094ff;
			}
			
        	table {
        		line-height: 1.4rem;
        		border-collapse: collapse;
        	}
		</style>
		
		<script type="text/javascript">
			var domain = 'http://localhost:8899';
			var userName;
			var token;
			$(function(){
				var screen = $.mobile.getScreenHeight();
				var header = $(".ui-header").hasClass("ui-header-fixed") ? $(".ui-header").outerHeight()  - 1 : $(".ui-header").outerHeight();
				var footer = $(".ui-footer").hasClass("ui-footer-fixed") ? $(".ui-footer").outerHeight() - 1 : $(".ui-footer").outerHeight();
				var contentCurrent = $(".ui-content").outerHeight() - $(".ui-content").height();
				var content = screen - header - footer - contentCurrent;
				$(".ui-content").height(content);
				
				var beforPeriodDivHeight = $('#beforPeriodDiv').outerHeight();
				var nowPeriodDivHeight = $('#nowPeriodDiv').outerHeight();
				
				var gameDivHeight = content - beforPeriodDivHeight - nowPeriodDivHeight;
				$('#gameDiv').outerHeight(gameDivHeight);
				$('#leftDiv').outerHeight(gameDivHeight);
				$('#rightOneDiv').outerHeight(gameDivHeight);
				$('#rightTwoDiv').outerHeight(gameDivHeight);
				$('#rightThreeDiv').outerHeight(gameDivHeight);
				
				var gameDivWidth = $('#gameDiv').width() - $('#leftDiv').width() - 4;
				$('#rightOneDiv').width(gameDivWidth);
				$('#rightTwoDiv').width(gameDivWidth);
				$('#rightThreeDiv').width(gameDivWidth);
			});
			
			$(document).on('pageinit', '#mainPage', function () {
				getBeforPeriod();
				getNowPeriod();
			});
			
			function login() {
				var account = $('#account').val();
				var pwd = $.md5($('#pwd').val());
				$.ajax({
					url: domain + '/lottery/user/login',
					type: 'POST',
					dataType: 'json',
					async: true,
					data: {
						'account': account,
						'pwd': pwd
					},
					success: function (result) {
						if(result.code == 200){
							userName = result.data.name;
							token = result.data.token;
							$('#loginPage').dialog('close');
						}else{
							alert(result.message);
						}
					},
					error: function (request, error) {
						alert('无法连接网络或者返回值错误!');
					}
				});
			}
			
			function getBeforPeriod() {
				$.ajax({
					url: domain + '/lottery/period/beforPeriod',
					dataType: 'json',
					async: true,
					success: function (result) {
						if(result.code == 200){
							if(result.data){
								$('#beforCode').html(result.data.code);
								
								if(result.data.result){
									var resultArr = result.data.result.split(',');
									$('#round1').html(resultArr[0]);
									$('#round2').html(resultArr[1]);
									$('#round3').html(resultArr[2]);
									$('#round4').html(resultArr[3]);
									$('#round5').html(resultArr[4]);
								}
							}
						}else{
							alert(result.message);
						}
					},
					error: function (request, error) {
						alert('无法连接网络或者返回值错误!');
					}
				});
			}
			
			function getNowPeriod() {
				$.ajax({
					url: domain + '/lottery/period/nowPeriod',
					dataType: 'json',
					async: true,
					success: function (result) {
						if(result.code == 200){
							if(result.data){
								$('#nowCode').html(result.data.code);
								
								if(result.data.status == 0){
									var endTime = result.data.endTime;
									var finishTime = result.data.finishTime;
									var periodTimer = setInterval(function(){
										if(endTime > 0){
											var endS = parseInt(endTime / 60);
											if(endS < 10){
												endS = '0' + endS;
											}
											
											var endM = endTime % 60;
											if(endM < 10){
												endM = '0' + endM;
											}
											
											$('#endTimeSpan').html(endS + ":" + endM);
											endTime -= 1;
										}else{
											$('#endTimeSpan').html('已封盘');
										}
										
										if(finishTime > 0){
											var endS = parseInt(finishTime / 60);
											if(endS < 10){
												endS = '0' + endS;
											}
											
											var endM = finishTime % 60;
											if(endM < 10){
												endM = '0' + endM;
											}
											
											$('#finishTimeSpan').html(endS + ":" + endM);
											finishTime -= 1;
										}else{
											clearInterval(periodTimer);
											getBeforPeriod();
											getNowPeriod();
										}
									}, 1000);
								}
							}
						}else{
							alert(result.message);
						}
					},
					error: function (request, error) {
						alert('无法连接网络或者返回值错误!');
					}
				});
			}
			
			function showRightDiv(showName) {
				if('rightOneDiv' == showName){
					$('#rightOneDiv').css("display", "block");
				}else{
					$('#rightOneDiv').css("display", "none");
				}
				
				if('rightTwoDiv' == showName){
					$('#rightTwoDiv').css("display", "block");
				}else{
					$('#rightTwoDiv').css("display", "none");
				}
				
				if('rightThreeDiv' == showName){
					$('#rightThreeDiv').css("display", "block");
				}else{
					$('#rightThreeDiv').css("display", "none");
				}
			}
		</script>
	</head>
	
	<body>
		<div data-role="page" id="mainPage" data-theme="a">
			<div data-role="header">
				<h1>欢迎来到我的主页</h1>
				<a class="ui-btn-right" data-rel="dialog" href="#loginPage">登陆</a>
			</div>
			
			<div id="contentDiv" data-role="content">
				<div id="beforPeriodDiv" style="height: 39px; border-bottom: 1px solid rgb(217, 232, 247);">
					第<span id='beforCode'>---</span>期:
					<span id="round1" class="round">-</span><span id="round2" class="round">-</span><span id="round3" class="round">-</span><span id="round4" class="round">-</span><span id="round5" class="round">-</span>
				</div>
				<div id="nowPeriodDiv" class="ui-grid-a" style="height: 24px; border-bottom: 1px solid rgb(217, 232, 247);">
					<div class="ui-block-a">
						第<span id='nowCode'>---</span>期
					</div>
					<div class="ui-block-b" style="text-align:right;">
						<span>封盘:</span><span id="endTimeSpan">--:--</span>&nbsp;
						<span>开奖:</span><span id="finishTimeSpan">--:--</span>
					</div>
				</div>
				<div id="gameDiv" style="background: olive;">
					<div style="float:left; width:5rem; border:1px solid #00F;">
						<div onclick="showRightDiv('rightOneDiv')">两面</div>
						<div onclick="showRightDiv('rightTwoDiv')">1-5球</div>
						<div onclick="showRightDiv('rightThreeDiv')">前中后</div>
					</div>
					<div style="float:right;width:200px;border:1px solid #00F;height:50px;">
						<table>
							<tr>
								<td>
									
								</td>
								<td>
									
								</td>
							</tr>
						</table>
					</div>
					<div style="clear:both;"></div>
				</div>
			</div>
			
			<div data-role="footer" data-position="fixed" style="height: 120px;">
				<div style="margin-left: 1rem; margin-top: .5rem;">已选中<span>0</span>注</div>
				<div class="ui-grid-a" style="margin-left: 1rem;">
					<div class="ui-block-a" style="width: 10rem; margin-top: 1rem;">
						<input>
					</div>
					<div class="ui-block-b" style="text-align:right;">
						<button style="">下注</button>
						<button>重置</button>
					</div>					
				</div>
			</div>
		</div>
		
		<div data-role="page" id="loginPage">
			<div data-role="header">
				<h1>用户登陆</h1>
			</div>
			<div data-role="content">
				<label for="account">账号：</label><input id="account" name="account" type="text">
				<label for="pwd">密码：</label><input id="pwd" name="pwd" type="password">
				<div style="text-align:center;">
					<input type="button" data-inline="true" onclick="login()" value="登陆">
				</div>
			</div>
		</div>
	</body>
</html>